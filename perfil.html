<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="nav-bar">
            <a href="dashboard.html">Trading</a>
            <a href="transferir.html">Transferir</a>
            <a href="perfil.html">Mi Perfil</a>
            <a href="admin.html" id="admin-link" style="display:none;">Admin</a>
            <a href="#" onclick="cerrarSesion()">Cerrar sesi칩n</a>
        </div>

        <h1>Mi Perfil</h1>

        <div class="card">
            <h2>Tus tarjetas virtuales</h2>
            <div id="tarjetas-container">Cargando...</div>
        </div>

        <div class="card">
            <h2>Estad칤sticas</h2>
            <div class="estadisticas-grid">
                <div class="estadistica-item">
                    <span class="estadistica-label">Usuario:</span>
                    <span class="estadistica-value" id="nombre-usuario"></span>
                </div>
                <div class="estadistica-item">
                    <span class="estadistica-label">Saldo USDT:</span>
                    <span class="estadistica-value" id="saldo-usdt">0.00</span>
                </div>
                <div class="estadistica-item">
                    <span class="estadistica-label">BTC:</span>
                    <span class="estadistica-value" id="saldo-btc">0.0000</span>
                </div>
                <div class="estadistica-item">
                    <span class="estadistica-label">Valor total:</span>
                    <span class="estadistica-value" id="valor-total">0.00 USDT</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Logros</h2>
            <div id="logros-lista">Cargando...</div>
        </div>
    </div>

    <script>
        const GITHUB_TOKEN = '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';
        const REPO = 'robtegastudio/juego-trading';

        let usuario = localStorage.getItem('usuario');
        if (!usuario) window.location.href = 'index.html';
        document.getElementById('nombre-usuario').innerText = usuario;

        async function cargarPerfil() {
            try {
                const res = await fetch('users.json?t=' + Date.now());
                const users = await res.json();
                const userData = users[usuario] || { saldoUSDT: 1000, btc: 0, tarjetas: [], movimientos: [] };
                document.getElementById('saldo-usdt').innerText = userData.saldoUSDT.toFixed(2);
                document.getElementById('saldo-btc').innerText = (userData.btc || 0).toFixed(4);

                // Mostrar enlace admin si el rol es admin
                if (users[usuario] && users[usuario].rol === 'admin') {
                    document.getElementById('admin-link').style.display = 'inline-block';
                }

                // Precio para valor total
                let precioBTC = 50000;
                try {
                    const priceRes = await fetch('prices.json?t=' + Date.now());
                    if (priceRes.ok) {
                        const priceData = await priceRes.json();
                        precioBTC = priceData.BTC.precio;
                    }
                } catch (e) {}
                const valorTotal = userData.saldoUSDT + (userData.btc || 0) * precioBTC;
                document.getElementById('valor-total').innerText = valorTotal.toFixed(2) + ' USDT';

                // Mostrar tarjetas (ya no hay bot칩n para solicitar)
                const tarjetas = userData.tarjetas || [];
                let html = '';
                if (tarjetas.length === 0) {
                    html = '<p>A칰n no tienes tarjetas. Sigue acumulando saldo para obtenerlas autom치ticamente.</p>';
                } else {
                    html = '<div class="tarjetas-grid">';
                    tarjetas.forEach(t => {
                        html += `<div class="tarjeta-item" style="background: linear-gradient(135deg, ${t.color1}, ${t.color2});">
                            <div style="font-size:1.2rem;">游눱 ${t.tipo.toUpperCase()}</div>
                            <div>**** **** **** ${t.ultimos4}</div>
                            <div>CVV: ${t.cvv}</div>
                            <div>Exp: ${t.mes}/${t.anio}</div>
                        </div>`;
                    });
                    html += '</div>';
                }
                document.getElementById('tarjetas-container').innerHTML = html;

                // Logros basados en saldo (esto es solo visual, las tarjetas ya est치n asignadas)
                let logros = [];
                if (userData.saldoUSDT >= 5000) logros.push('游눯 Acumulador de plata (5000 USDT)');
                if (userData.saldoUSDT >= 10000) logros.push('游눑 Acumulador de oro (10000 USDT)');
                if (userData.saldoUSDT >= 20000) logros.push('游녬 Acumulador de diamante (20000 USDT)');
                if (userData.btc >= 0.1) logros.push('游뿣 Ballena de BTC (0.1 BTC)');
                if (logros.length === 0) logros.push('Sin logros a칰n');
                document.getElementById('logros-lista').innerHTML = '<ul>' + logros.map(l => `<li>${l}</li>`).join('') + '</ul>';
            } catch (e) {
                console.error(e);
                document.getElementById('tarjetas-container').innerHTML = 'Error al cargar';
            }
        }

        window.cerrarSesion = function() {
            localStorage.removeItem('usuario');
            window.location.href = 'index.html';
        };

        window.onload = cargarPerfil;
    </script>
</body>
</html>
